### **担当4: データ永続化とプロジェクト基盤 リファクタリング計画 (TODOリスト)**

この計画は、現在のモック実装から実際のSQLiteデータベースへの移行、およびリポジトリパターンの導入を通じて、データ永続化層の堅牢性と保守性を向上させることを目的とします。

**重さの定義:**
*   **小:** 1〜2ファイル程度の修正。影響範囲が限定的。
*   **中:** 複数ファイルにまたがる修正。コンポーネントの統合やロジックの分離を含む。
*   **大:** アーキテクチャの根幹に関わる変更。広範囲な影響が想定され、慎重な作業が必要。

---

### **フェーズ1: リポジトリ層の導入とインターフェース定義**

*   [ ] **タスク:** `repositories/interfaces/` ディレクトリ内に、各エンティティ（Person, Event, Tag）に対応するリポジトリインターフェースを定義する。
    *   **詳細:** 例: `IPersonRepository.ts`, `IEventRepository.ts`, `ITagRepository.ts`。CRUD操作のメソッドシグネチャを定義する。
    *   **重さ:** 中
*   [ ] **タスク:** `database/sqlite-types.ts` の型定義をレビューし、リポジトリ層で利用しやすいように調整する（必要であれば）。
    *   **重さ:** 小

---

### **フェーズ2: SQLite実装への移行**

*   [ ] **タスク:** `repositories/implementations/sqlite/` ディレクトリを新規作成し、SQLiteデータベースとの実際のやり取りを担う具体的なリポジトリ実装クラスを定義する。
    *   **詳細:** 例: `SQLitePersonRepository.ts`, `SQLiteEventRepository.ts`, `SQLiteTagRepository.ts`。各クラスは対応するインターフェースを実装する。
    *   **重さ:** 大
*   [ ] **タスク:** データベース初期化（スキーマ作成）およびマイグレーションの仕組みを導入する。
    *   **詳細:** 例: `database/init.ts` や `database/migrations/` ディレクトリを作成し、アプリ起動時にデータベースの準備を行うロジックを実装する。
    *   **重さ:** 大
*   [ ] **タスク:** 現在の `database/sqlite-services/` 内のモック実装を、新しく作成したSQLiteリポジトリ実装を利用するように変更する。
    *   **詳細:** 各サービスは、対応するリポジトリインターフェースのインスタンスを受け取るように修正し、直接データベース操作を行わないようにする。
    *   **重さ:** 大

---

### **フェーズ3: サービス層のクリーンアップとDIの検討**

*   [ ] **タスク:** `database/sqlite-services/index.ts` のエクスポートエイリアスをレビューし、よりシンプルで分かりやすい命名規則を検討する（例: `createTag` ではなく `TagService.create` を直接使用するなど）。
    *   **重さ:** 小
*   [ ] **タスク:** サービス層がリポジトリ層に依存する形になるため、依存性注入（DI）のパターンを導入するか検討する。
    *   **詳細:** 例えば、サービスコンストラクタでリポジトリインスタンスを受け取るようにする。これにより、テスト容易性が向上する。
    *   **重さ:** 中

---

### **フェーズ4: プロジェクト基盤のレビューと改善**

*   [ ] **タスク:** `constants/Colors.ts` をレビューし、テーマカラーの定義が適切か、拡張性があるかを確認する。
    *   **重さ:** 小
*   [ ] **タスク:** `contexts/ThemeContext.tsx` をレビューし、テーマ管理のロジックが適切か、`useThemeColor` との連携がスムーズかを確認する。
    *   **重さ:** 小
*   [ ] **タスク:** `package.json` の依存関係をレビューし、不要なパッケージがないか、バージョンが適切かを確認する。
    *   **重さ:** 小
*   [ ] **タスク:** `tsconfig.json` をレビューし、TypeScriptの設定がプロジェクトの要件に合致しているか、厳密性が適切かを確認する。
    *   **重さ:** 小
*   [ ] **タスク:** `jest.config.js`, `jest.setup.js` をレビューし、テスト環境の設定が適切か、モックの管理が効率的かを確認する。
    *   **重さ:** 小
*   [ ] **タスク:** `scripts/reset-project.js` をレビューし、開発環境のリセットスクリプトが意図通りに動作するか、安全かを確認する。
    *   **重さ:** 小