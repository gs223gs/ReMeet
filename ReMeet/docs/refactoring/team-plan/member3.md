# メンバー3: UIロジック分離・カスタムフック担当

## 担当概要
画面コンポーネントからビジネスロジックを抽出し、カスタムフックとして分離する。既存の全機能（スワイプメニュー制御、useFocusEffect、Jotai連携）を完全に維持しながら、責務を明確化する。

## 全体タスク期間: 7日間

---

## タスク1: 既存UIロジックの詳細調査（1日目）

### 1.1 people.tsx の詳細分析
**所要時間**: 2時間
**重要度**: 高

- [ ] `app/(tabs)/people.tsx` の全機能を詳細に分析
- [ ] **重要**: `useFocusEffect` によるデータフェッチ機能を調査
- [ ] **重要**: `openedMenuIdAtom` とスワイプメニュー制御を調査
- [ ] TanStack Query との連携パターンを分析
- [ ] Jotai Atoms との双方向データフローを分析

### 1.2 person-detail.tsx の詳細分析
**所要時間**: 1.5時間
**重要度**: 高

- [ ] `app/person-detail.tsx` の全機能を詳細に分析
- [ ] **重要**: 削除確認ダイアログの実装を調査
- [ ] **重要**: キャッシュ無効化の仕組みを調査
- [ ] `useLocalSearchParams` でのID取得を分析
- [ ] データ取得とエラーハンドリングを分析

### 1.3 events.tsx の詳細分析
**所要時間**: 1.5時間
**重要度**: 高

- [ ] `app/(tabs)/events.tsx` の全機能を詳細に分析
- [ ] **重要**: 人物-イベント関連付け機能を調査
- [ ] データ取得とフィルタリング機能を分析
- [ ] 画面遷移ロジックを分析
- [ ] 既存の状態管理パターンを分析

### 1.4 フォーム画面の詳細分析
**所要時間**: 2時間
**重要度**: 高

- [ ] `app/person-register.tsx` と `app/person-edit.tsx` を分析
- [ ] **重要**: Zodバリデーションの詳細ルールを調査
- [ ] **重要**: タグ新規作成フロー (`findOrCreateByNames`) を調査
- [ ] React Hook Form との連携を分析
- [ ] データ送信とエラーハンドリングを分析

### 1.5 カスタムフック設計
**所要時間**: 1時間
**重要度**: 高

- [ ] 各画面から抽出すべきロジックを整理
- [ ] カスタムフックの責務と境界を明確化
- [ ] 既存機能を完全に維持する設計を作成
- [ ] 他メンバーとの連携ポイントを確認

---

## タスク2: usePeopleScreen フックの作成（2日目）

### 2.1 hooks ディレクトリの準備
**所要時間**: 0.5時間
**重要度**: 中

- [ ] `hooks/` ディレクトリを作成（メンバー1と連携）
- [ ] TypeScript設定を確認
- [ ] 既存のhooks構造を調査
- [ ] 命名規則を確認

### 2.2 usePeopleScreen の基本構造作成
**所要時間**: 1時間
**重要度**: 高

- [ ] `hooks/usePeopleScreen.ts` を作成
- [ ] 必要なimportを全て追加
- [ ] 戻り値の型定義を作成
- [ ] 基本的な構造を実装

### 2.3 データフェッチ機能の実装
**所要時間**: 1.5時間
**重要度**: 高

- [ ] **重要**: `useFocusEffect` を使用したデータフェッチを実装
- [ ] TanStack Query の `useQuery` との連携を実装
- [ ] ローディング状態の管理を実装
- [ ] エラーハンドリングを実装

### 2.4 スワイプメニュー制御の実装
**所要時間**: 2時間
**重要度**: 高

- [ ] **重要**: `openedMenuIdAtom` との連携を実装
- [ ] **重要**: スワイプメニューの同時開放制御を実装
- [ ] スワイプ削除機能を実装
- [ ] 削除確認ダイアログを実装

### 2.5 画面遷移とその他機能の実装
**所要時間**: 3時間
**重要度**: 高

- [ ] `useRouter` を使用した画面遷移を実装
- [ ] 検索・フィルタリング機能を実装
- [ ] Jotai Atoms との双方向データフローを実装
- [ ] 既存の `people.tsx` と完全に同じ動作を確認

---

## タスク3: usePersonDetail フックの作成（3日目）

### 3.1 usePersonDetail の基本構造作成
**所要時間**: 1時間
**重要度**: 高

- [ ] `hooks/usePersonDetail.ts` を作成
- [ ] 必要なimportを全て追加
- [ ] 戻り値の型定義を作成
- [ ] 基本的な構造を実装

### 3.2 IDパラメータ取得とデータフェッチ
**所要時間**: 1.5時間
**重要度**: 高

- [ ] `useLocalSearchParams` を使用したID取得を実装
- [ ] TanStack Query を使用したデータ取得を実装
- [ ] ローディング状態の管理を実装
- [ ] エラーハンドリングを実装

### 3.3 削除機能の実装
**所要時間**: 2時間
**重要度**: 高

- [ ] **重要**: 削除確認ダイアログを実装
- [ ] **重要**: `usePersonMutations` との連携を実装
- [ ] **重要**: 削除後のキャッシュ無効化を実装
- [ ] 削除後の画面遷移を実装

### 3.4 画面遷移とその他機能
**所要時間**: 1.5時間
**重要度**: 高

- [ ] 編集画面への遷移を実装
- [ ] 戻る機能を実装
- [ ] アラート表示機能を実装
- [ ] 既存の `person-detail.tsx` と完全に同じ動作を確認

### 3.5 usePersonDetail の統合テスト
**所要時間**: 2時間
**重要度**: 高

- [ ] 全機能の統合テスト
- [ ] 削除機能の詳細テスト
- [ ] エラーケースのテスト
- [ ] パフォーマンステスト

---

## タスク4: useEventsScreen フックの作成（4日目）

### 4.1 useEventsScreen の基本構造作成
**所要時間**: 1時間
**重要度**: 高

- [ ] `hooks/useEventsScreen.ts` を作成
- [ ] 必要なimportを全て追加
- [ ] 戻り値の型定義を作成
- [ ] 基本的な構造を実装

### 4.2 イベントデータの取得と管理
**所要時間**: 1.5時間
**重要度**: 高

- [ ] TanStack Query を使用したイベントデータ取得を実装
- [ ] ローディング状態の管理を実装
- [ ] エラーハンドリングを実装
- [ ] データの並び替え・フィルタリングを実装

### 4.3 人物-イベント関連付け機能
**所要時間**: 2時間
**重要度**: 高

- [ ] **重要**: 人物-イベント関連付け機能を実装
- [ ] 関連付けデータの取得を実装
- [ ] 関連付けの表示機能を実装
- [ ] 関連付けの更新機能を実装

### 4.4 画面遷移とその他機能
**所要時間**: 1.5時間
**重要度**: 高

- [ ] イベント登録画面への遷移を実装
- [ ] イベント詳細画面への遷移を実装
- [ ] 検索・フィルタリング機能を実装
- [ ] 既存の `events.tsx` と完全に同じ動作を確認

### 4.5 useEventsScreen の統合テスト
**所要時間**: 2時間
**重要度**: 高

- [ ] 全機能の統合テスト
- [ ] 人物-イベント関連付けの詳細テスト
- [ ] エラーケースのテスト
- [ ] パフォーマンステスト

---

## タスク5: usePersonForm・useEventForm フックの作成（5日目）

### 5.1 usePersonForm の基本構造作成
**所要時間**: 1時間
**重要度**: 高

- [ ] `hooks/usePersonForm.ts` を作成
- [ ] 必要なimportを全て追加
- [ ] 戻り値の型定義を作成
- [ ] 基本的な構造を実装

### 5.2 フォームバリデーション機能
**所要時間**: 1.5時間
**重要度**: 高

- [ ] **重要**: Zodバリデーションの全ルールを実装
- [ ] React Hook Form との連携を実装
- [ ] バリデーションエラーの表示を実装
- [ ] 既存のバリデーション動作を完全に維持

### 5.3 タグ新規作成機能
**所要時間**: 2時間
**重要度**: 高

- [ ] **重要**: `findOrCreateByNames` を使用したタグ新規作成を実装
- [ ] 既存タグ選択機能を実装
- [ ] タグ削除機能を実装
- [ ] タグ入力のバリデーションを実装

### 5.4 useEventForm の実装
**所要時間**: 1.5時間
**重要度**: 高

- [ ] `hooks/useEventForm.ts` を作成
- [ ] **重要**: DateTimePicker設定（テーマ対応）を実装
- [ ] **重要**: 過去の日付のみ選択可能な制限を実装
- [ ] 日付クリア機能を実装

### 5.5 フォーム関連フックの統合テスト
**所要時間**: 2時間
**重要度**: 高

- [ ] usePersonForm の全機能テスト
- [ ] useEventForm の全機能テスト
- [ ] タグ新規作成機能の詳細テスト
- [ ] 日付選択機能の詳細テスト

---

## タスク6: 既存画面コンポーネントの修正（6日目）

### 6.1 people.tsx の修正
**所要時間**: 1.5時間
**重要度**: 高

- [ ] `app/(tabs)/people.tsx` を `usePeopleScreen` を使用する形に修正
- [ ] **重要**: 全機能を維持しながらプレゼンテーショナルに特化
- [ ] **重要**: Jotai ↔ TanStack Query の双方向データフローを維持
- [ ] 修正前後で完全に同じ動作を確認

### 6.2 person-detail.tsx の修正
**所要時間**: 1時間
**重要度**: 高

- [ ] `app/person-detail.tsx` を `usePersonDetail` を使用する形に修正
- [ ] **重要**: 削除機能を完全に維持
- [ ] プレゼンテーショナルコンポーネントに特化
- [ ] 修正前後で完全に同じ動作を確認

### 6.3 events.tsx の修正
**所要時間**: 1時間
**重要度**: 高

- [ ] `app/(tabs)/events.tsx` を `useEventsScreen` を使用する形に修正
- [ ] **重要**: 人物-イベント関連付け機能を完全に維持
- [ ] プレゼンテーショナルコンポーネントに特化
- [ ] 修正前後で完全に同じ動作を確認

### 6.4 フォーム画面の修正
**所要時間**: 2時間
**重要度**: 高

- [ ] `app/person-register.tsx` を `usePersonForm` を使用する形に修正
- [ ] `app/person-edit.tsx` を `usePersonForm` を使用する形に修正
- [ ] **重要**: Zodバリデーションとタグ新規作成を完全に維持
- [ ] 修正前後で完全に同じ動作を確認

### 6.5 全画面の統合テスト
**所要時間**: 2.5時間
**重要度**: 高

- [ ] 全画面の統合テスト
- [ ] 画面間の遷移テスト
- [ ] 全機能の動作確認
- [ ] パフォーマンステスト

---

## タスク7: 最終検証と完了報告（7日目）

### 7.1 既存機能の完全性確認
**所要時間**: 2時間
**重要度**: 高

- [ ] **重要**: スワイプメニューの同時開放制御の動作確認
- [ ] **重要**: useFocusEffect によるデータフェッチの動作確認
- [ ] **重要**: タグ新規作成フローの動作確認
- [ ] **重要**: 削除確認ダイアログとキャッシュ無効化の動作確認

### 7.2 パフォーマンス・安定性確認
**所要時間**: 1.5時間
**重要度**: 高

- [ ] アプリ全体のパフォーマンステスト
- [ ] メモリリークがないことを確認
- [ ] 長時間使用での安定性確認
- [ ] エラーケースでの動作確認

### 7.3 コードクリーンアップ
**所要時間**: 1時間
**重要度**: 中

- [ ] 不要なコードの削除
- [ ] TypeScript型定義の最適化
- [ ] importの整理
- [ ] コメントの追加

### 7.4 ドキュメント作成
**所要時間**: 1.5時間
**重要度**: 中

- [ ] 各カスタムフックの使用方法ドキュメント
- [ ] 既存機能の保持状況レポート
- [ ] 注意事項とベストプラクティス
- [ ] 他メンバーとの連携方法

### 7.5 完了報告と引き継ぎ
**所要時間**: 2時間
**重要度**: 高

- [ ] 作業完了報告書を作成
- [ ] 変更内容の詳細を記録
- [ ] 他メンバーへの引き継ぎ資料を作成
- [ ] 問題点と注意事項を整理
- [ ] 次フェーズの準備を完了

---

## 成果物

1. **カスタムフック**
   - `usePeopleScreen.ts` - 人物一覧画面の全ロジック
   - `usePersonDetail.ts` - 人物詳細画面の全ロジック
   - `useEventsScreen.ts` - イベント一覧画面の全ロジック
   - `usePersonForm.ts` - 人物フォームの全ロジック
   - `useEventForm.ts` - イベントフォームの全ロジック

2. **更新された画面コンポーネント**
   - プレゼンテーショナルコンポーネントに特化
   - 全機能を維持

3. **ドキュメント**
   - カスタムフック使用方法
   - 既存機能保持レポート
   - 引き継ぎ資料

## 重要な注意事項

1. **既存機能の完全保持**
   - **スワイプメニューの同時開放制御**: openedMenuIdAtom との連携を完全に維持
   - **useFocusEffect**: ページフォーカス時のデータフェッチを完全に維持
   - **タグ新規作成**: findOrCreateByNames の動作を完全に維持
   - **削除確認ダイアログ**: キャッシュ無効化を含む全機能を完全に維持

2. **Jotai ↔ TanStack Query データフロー**
   - 双方向データフローを完全に維持
   - 既存の状態管理パターンを破壊しない
   - データの整合性を保つ

3. **段階的な移行**
   - 各画面を個別に移行
   - 移行前後で完全に同じ動作を確認
   - 問題があれば即座にロールバック

4. **テストの徹底**
   - 各フックの個別テスト
   - 画面全体の統合テスト
   - 既存機能の完全性確認
   - パフォーマンステスト

5. **他メンバーとの連携**
   - メンバー1の基盤整備完了を待つ
   - メンバー2のデータ層変更と連携
   - 変更内容を随時共有